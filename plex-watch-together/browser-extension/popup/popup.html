<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Plex Watch Together</title>
  <style>
    body {
      width: 320px;
      min-height: 400px;
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a1a;
      color: white;
      box-sizing: border-box;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .header h1 {
      margin: 0;
      font-size: 20px;
      color: #e5a00d;
    }

    .header .subtitle {
      font-size: 12px;
      color: #888;
      margin-top: 5px;
    }

    .status {
      background: #333;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status.connected {
      background: #2e7d32;
    }

    .status.error {
      background: #d32f2f;
    }

    .status-icon {
      font-size: 16px;
    }

    .status-text {
      font-size: 14px;
    }

    .section {
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 10px;
      color: #e5a00d;
    }

    .input-group {
      margin-bottom: 10px;
    }

    .input-group label {
      display: block;
      font-size: 12px;
      color: #ccc;
      margin-bottom: 4px;
    }

    .input-group input {
      width: 100%;
      padding: 10px;
      background: #333;
      border: 1px solid #555;
      border-radius: 4px;
      color: white;
      font-size: 14px;
      box-sizing: border-box;
    }

    .input-group input:focus {
      outline: none;
      border-color: #e5a00d;
    }

    .button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      margin-bottom: 8px;
      transition: all 0.2s;
    }

    .button:hover {
      opacity: 0.9;
    }

    .button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .button.primary {
      background: #e5a00d;
      color: white;
    }

    .button.secondary {
      background: #666;
      color: white;
    }

    .button.danger {
      background: #d32f2f;
      color: white;
    }

    .room-info {
      background: #2a2a2a;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 15px;
    }

    .room-info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      font-size: 14px;
    }

    .room-info-row:last-child {
      margin-bottom: 0;
    }

    .room-info-label {
      color: #ccc;
    }

    .room-info-value {
      color: white;
      font-weight: 500;
    }

    .qr-section {
      text-align: center;
      background: #2a2a2a;
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .qr-code {
      border: 1px solid #555;
      border-radius: 4px;
      margin: 10px 0;
    }

    .room-id-display {
      background: #333;
      border: 1px solid #555;
      border-radius: 4px;
      padding: 8px;
      text-align: center;
      font-family: monospace;
      font-size: 16px;
      letter-spacing: 2px;
      margin: 10px 0;
      cursor: pointer;
      user-select: all;
    }

    .room-id-display:hover {
      background: #444;
    }

    .participants {
      background: #2a2a2a;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 15px;
    }

    .participant {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 0;
      border-bottom: 1px solid #333;
    }

    .participant:last-child {
      border-bottom: none;
    }

    .participant-icon {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #4caf50;
    }

    .participant-name {
      flex: 1;
      font-size: 14px;
    }

    .participant-role {
      font-size: 12px;
      color: #888;
    }

    .no-plex-warning {
      background: #ff9800;
      color: #000;
      padding: 12px;
      border-radius: 6px;
      font-size: 14px;
      text-align: center;
      margin-bottom: 15px;
    }

    .hidden {
      display: none !important;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #888;
    }

    .tab-buttons {
      display: flex;
      background: #333;
      border-radius: 6px;
      margin-bottom: 15px;
      overflow: hidden;
    }

    .tab-button {
      flex: 1;
      padding: 10px;
      background: transparent;
      border: none;
      color: #ccc;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tab-button.active {
      background: #e5a00d;
      color: white;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üé¨ Plex Watch Together</h1>
    <div class="subtitle">Sync your viewing experience</div>
  </div>

  <div id="loading" class="loading">
    <div>Checking Plex status...</div>
  </div>

  <div id="no-plex-warning" class="no-plex-warning hidden">
    ‚ö†Ô∏è Please open Plex (app.plex.tv) in a tab first
  </div>

  <div id="main-content" class="hidden">
    <div id="status" class="status">
      <div class="status-icon">üî¥</div>
      <div class="status-text">Not connected</div>
    </div>

    <div class="tab-buttons">
      <button class="tab-button active" data-tab="create">Create</button>
      <button class="tab-button" data-tab="join">Join</button>
    </div>

    <!-- Create Room Tab -->
    <div id="create-tab" class="tab-content active">
      <div class="section">
        <div class="input-group">
          <label for="user-name">Your Name</label>
          <input type="text" id="user-name" placeholder="Enter your name">
        </div>
        
        <button id="create-room-btn" class="button primary">
          üéØ Create Watch Party
        </button>
      </div>

      <div id="room-created" class="hidden">
        <div class="section-title">Room Created!</div>
        
        <div class="room-id-display" id="room-id-display" title="Click to copy">
          ROOM123
        </div>

        <div id="qr-section" class="qr-section">
          <div style="font-size: 14px; margin-bottom: 10px;">Share QR Code:</div>
          <canvas id="qr-code" class="qr-code" width="200" height="200"></canvas>
          <div style="font-size: 12px; color: #888; margin-top: 8px;">
            Others can scan this to join instantly
          </div>
        </div>
      </div>
    </div>

    <!-- Join Room Tab -->
    <div id="join-tab" class="tab-content">
      <div class="section">
        <div class="input-group">
          <label for="join-user-name">Your Name</label>
          <input type="text" id="join-user-name" placeholder="Enter your name">
        </div>
        
        <div class="input-group">
          <label for="room-id-input">Room ID</label>
          <input type="text" id="room-id-input" placeholder="Enter room ID">
        </div>
        
        <button id="join-room-btn" class="button primary">
          üöÄ Join Watch Party
        </button>
      </div>

      <div class="section">
        <div style="text-align: center; margin: 15px 0; color: #888; font-size: 14px;">
          ‚Äî or ‚Äî
        </div>
        
        <button id="scan-qr-btn" class="button secondary">
          üì± Scan QR Code
        </button>
      </div>
    </div>

    <!-- Room Info (shown when connected) -->
    <div id="room-info-section" class="hidden">
      <div class="section-title">Room Information</div>
      
      <div class="room-info">
        <div class="room-info-row">
          <span class="room-info-label">Room ID:</span>
          <span class="room-info-value" id="current-room-id">-</span>
        </div>
        <div class="room-info-row">
          <span class="room-info-label">Your Role:</span>
          <span class="room-info-value" id="user-role">-</span>
        </div>
        <div class="room-info-row">
          <span class="room-info-label">Participants:</span>
          <span class="room-info-value" id="participant-count">0</span>
        </div>
      </div>

      <div id="participants-list" class="participants hidden">
        <div class="section-title">Participants</div>
        <div id="participants-container"></div>
      </div>

      <button id="leave-room-btn" class="button danger">
        üö™ Leave Room
      </button>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>